{
  "Name": "6.cargaAssuntos",
  "CreationDate": "2025-6-27",
  "Commands": [
    {
      "Command": "comment",
      "Target": "Esta macro cadastra Assuntos na tabela do SEI a partir de um arquivo CSV. INSTRU√á√ïES:",
      "Value": "Execute a Macro (Play Macro) a partir do sistema SEI > Menu \"Administra√ß√£o\" > \"Tabela de Assuntos\" > A√ß√£o \"Assuntos da Tabela\"",
      "Description": "Recomenda√ß√£o: no log, exibir a op√ß√£o \"Echo & Status\". N√£o deixe de conferir a documenta√ß√£o de refer√™ncia."
    },
    {
      "Command": "csvReadArray",
      "Target": "exemploAssuntos.csv",
      "Value": "assuntos",
      "Description": "Este primeiro comando l√™ os dados do arquivo CSV e os salva em uma estrutura interna da macro. Consulte a documenta√ß√£o de refer√™ncia para instru√ß√µes quanto √† montagem do arquivo CSV."
    },
    {
      "Command": "store",
      "Target": "1",
      "Value": "i",
      "Description": "IMPORTANTE: Este comando indica A PARTIR DE QUAL LINHA do arquivo de refer√™ncia a macro vai ser executada (e, dela, vai at√© o final) Se necess√°rio retomar a execu√ß√£o a partir de um erro, altere este valor para a linha da qual pretende retomar."
    },
    {
      "Command": "store",
      "Target": "${i}",
      "Value": "linhaInicial",
      "Description": "Salva a linha inicial para calcular o progresso da execu√ß√£o."
    },
    {
      "Command": "executeScript_Sandbox",
      "Target": "return Number(${assuntos}.length) - 1;",
      "Value": "totalLinhas",
      "Description": "Este comando obt√©m a quantidade de linhas da lista que foi importada do arquivo CSV."
    },
    {
      "Command": "executeScript_Sandbox",
      "Target": "var d = new Date(); return d.getTime()",
      "Value": "tempoInicio",
      "Description": "Registra o momento inicial da execu√ß√£o."
    },
    {
      "Command": "store",
      "Target": "0",
      "Value": "ok",
      "Description": "Este comando gera a vari√°vel que armazenar√° a quantidade de execu√ß√µes bem-sucedidas da macro."
    },
    {
      "Command": "store",
      "Target": "0",
      "Value": "falha",
      "Description": "Este comando gera a vari√°vel que armazenar√° a quantidade de execu√ß√µes mal-sucedidas da macro. (Erros no sistema, n√£o no pr√≥prio UI.Vision)"
    },
    {
      "Command": "echo",
      "Target": "üßÆ Iniciando processamento pela linha ${i}, de um total de ${totalLinhas}.",
      "Value": "",
      "Description": "Informa no log o ponto de partida."
    },
    {
      "Command": "while_v2",
      "Target": "${i} <= ${totalLinhas}",
      "Value": "",
      "Description": "O comando \"while\" indica que a macro deve executar uma determinada a√ß√£o enquanto uma condi√ß√£o espec√≠fica n√£o for satisfeita. A a√ß√£o √© retomar o cadastro da pr√≥xima linha e a condi√ß√£o, aqui, √© que o valor da linha em execu√ß√£o tem que ser inferior ao total de linhas."
    },
    {
      "Command": "echo",
      "Target": "üîÅ Processando linha ${i}: ${assuntos[${i}][1]} - ${assuntos[${i}][2]}.",
      "Value": "blue",
      "Description": "Exibe no log qual assunto est√° sendo cadastrado."
    },
    {
      "Command": "executeScript_Sandbox",
      "Target": "var atual = Number(${i}) - Number(${linhaInicial}); var total = Number(${totalLinhas}) - Number(${linhaInicial}) + 1; return Math.floor((atual / total) * 100);",
      "Value": "progresso",
      "Description": "Calcula o progresso relativo, de 0 a 100%."
    },
    {
      "Command": "executeScript_Sandbox",
      "Target": "var d = new Date(); return d.getTime()",
      "Value": "tempoAtual",
      "Description": "Registra o momento de in√≠cio de cada itera√ß√£o da macro."
    },
    {
      "Command": "executeScript_Sandbox",
      "Target": "return (${tempoAtual} - ${tempoInicio}) / (Number(${i}) + 1);",
      "Value": "tempoPorLinha",
      "Description": "Estima o tempo gasto em cada linha da macro."
    },
    {
      "Command": "executeScript_Sandbox",
      "Target": "var tempoEstimado = (Number(${totalLinhas}) - Number(${i})) * Number(${tempoPorLinha}); var min = Math.floor(tempoEstimado / 60000); var seg = Math.round((tempoEstimado % 60000) / 1000); var texto = '~ '; if (min > 0) texto += min + ' minuto' + (min != 1 ? 's' : ''); if (seg > 0 || min == 0) texto += (min > 0 ? ' ' : '') + seg + ' segundo' + (seg != 1 ? 's' : ''); return texto.trim();",
      "Value": "estimativa",
      "Description": "Calcula a estimativa de tempo restante em formato humanizado, considerando minutos e segundos com pluraliza√ß√£o."
    },
    {
      "Command": "if_v2",
      "Target": "${i} > 3",
      "Value": "",
      "Description": "Cria uma condicionante para exibir o tempo restante estimado apenas a partir da 4¬™ execu√ß√£o, quando a estimativa estar√° mais precisa."
    },
    {
      "Command": "echo",
      "Target": "üìà Progresso: ${progresso}% | ‚è≥ Tempo restante estimado: ${estimativa}",
      "Value": "blue",
      "Description": "Conforme condicional acima, exibe o progresso e o tempo restante estimado."
    },
    {
      "Command": "else",
      "Target": "",
      "Value": "",
      "Description": "Caso contr√°rio,"
    },
    {
      "Command": "echo",
      "Target": "üìà Progresso: ${progresso}%",
      "Value": "blue",
      "Description": "exibe (nas primeiras 3 linhas) apenas o progresso."
    },
    {
      "Command": "end",
      "Target": "",
      "Value": "",
      "Description": "encerra essa condicionante \"if\" (linha 16)."
    },
    {
      "Command": "click",
      "Target": "id=btnNovo",
      "Value": "",
      "Targets": [
        "id=btnNovo",
        "xpath=//*[@id=\"btnNovo\"]",
        "xpath=//button[@id='btnNovo']",
        "xpath=//button[2]",
        "css=#btnNovo"
      ],
      "Description": ""
    },
    {
      "Command": "type",
      "Target": "id=txtCodigoEstruturado",
      "Value": "${assuntos[${i}][1]}",
      "Targets": [
        "id=txtCodigoEstruturado",
        "name=txtCodigoEstruturado",
        "xpath=//*[@id=\"txtCodigoEstruturado\"]",
        "xpath=//input[@id='txtCodigoEstruturado']",
        "xpath=//input[2]",
        "css=#txtCodigoEstruturado"
      ],
      "Description": ""
    },
    {
      "Command": "type",
      "Target": "id=txtDescricao",
      "Value": "${assuntos[${i}][2]}",
      "Targets": [
        "id=txtDescricao",
        "name=txtDescricao",
        "xpath=//*[@id=\"txtDescricao\"]",
        "xpath=//input[@id='txtDescricao']",
        "xpath=//input[3]",
        "css=#txtDescricao"
      ],
      "Description": ""
    },
    {
      "Command": "if",
      "Target": "${assuntos[${i}][3]} === 'S' ",
      "Value": "",
      "Description": "Cria uma condi√ß√£o para tratar casos de perfil na unidade global (*)."
    },
    {
      "Command": "check",
      "Target": "id=chkSinEstrutural",
      "Value": "",
      "Targets": [
        "id=chkSinEstrutural",
        "name=chkSinEstrutural",
        "xpath=//*[@id=\"chkSinEstrutural\"]",
        "xpath=//input[@id='chkSinEstrutural']",
        "xpath=//div[2]/div/div/input",
        "css=#chkSinEstrutural"
      ],
      "Description": "Assinala a checkbox \"Item apenas estrutural\", que desabilita os demais campos e informa que o assunto cadastrado √© apenas para organizar a tabela."
    },
    {
      "Command": "assertChecked",
      "Target": "id=chkSinEstrutural",
      "Value": "",
      "Description": "Se assegura que a checkbox foi, de fato, assinalada."
    },
    {
      "Command": "type",
      "Target": "id=txaObservacao",
      "Value": "${assuntos[${i}][7]}",
      "Targets": [
        "id=txaObservacao",
        "name=txaObservacao",
        "xpath=//*[@id=\"txaObservacao\"]",
        "xpath=//textarea[@id='txaObservacao']",
        "xpath=//textarea",
        "css=#txaObservacao"
      ],
      "Description": "Insere o texto, caso haja, na observa√ß√£o do assunto cadastrado."
    },
    {
      "Command": "echo",
      "Target": "üóÑÔ∏è Assunto ${assuntos[${i}][1]} - ${assuntos[${i}][2]} √© apenas estrutural.",
      "Value": "purple",
      "Description": "Informa, no log do UI.Vision, se tratar de item apenas estrutural."
    },
    {
      "Command": "else",
      "Target": "",
      "Value": "",
      "Description": "Caso contr√°rio,"
    },
    {
      "Command": "uncheck",
      "Target": "id=chkSinEstrutural",
      "Value": "",
      "Description": "Desmarca a checkbox \"Item apenas estrutural\" para habilitar os demais campos para preenchimento."
    },
    {
      "Command": "assertNotChecked",
      "Target": "id=chkSinEstrutural",
      "Value": "",
      "Description": "Se assegura que a checkbox, de fato, n√£o foi assinalada."
    },
    {
      "Command": "type",
      "Target": "id=txtPrazoCorrente",
      "Value": "${assuntos[${i}][4]}",
      "Targets": [
        "id=txtPrazoCorrente",
        "name=txtPrazoCorrente",
        "xpath=//*[@id=\"txtPrazoCorrente\"]",
        "xpath=//input[@id='txtPrazoCorrente']",
        "xpath=//fieldset/input",
        "css=#txtPrazoCorrente"
      ],
      "Description": "Insere o prazo de guarda corrente, em anos."
    },
    {
      "Command": "type",
      "Target": "id=txtPrazoIntermediario",
      "Value": "${assuntos[${i}][5]}",
      "Targets": [
        "id=txtPrazoIntermediario",
        "name=txtPrazoIntermediario",
        "xpath=//*[@id=\"txtPrazoIntermediario\"]",
        "xpath=//input[@id='txtPrazoIntermediario']",
        "xpath=//fieldset/input[2]",
        "css=#txtPrazoIntermediario"
      ],
      "Description": "Insere o prazo de guarda intermedi√°ria, em anos."
    },
    {
      "Command": "if",
      "Target": "${assuntos[${i}][6]} === 'Guarda' ",
      "Value": "",
      "Description": "Esta condicional avalia se o assunto registrado no arquivo .csv deve ser registrado com a Destina√ß√£o Final \"Guarda Permanente\"."
    },
    {
      "Command": "check",
      "Target": "id=optGuardaPermanente",
      "Value": "G",
      "Targets": [
        "id=optGuardaPermanente",
        "name=rdoDestinacao",
        "xpath=//*[@id=\"optGuardaPermanente\"]",
        "xpath=//input[@id='optGuardaPermanente']",
        "xpath=//fieldset[2]/div/div/input",
        "css=#optGuardaPermanente"
      ],
      "Description": "E assinala o radio button correspondente."
    },
    {
      "Command": "assertChecked",
      "Target": "id=optGuardaPermanente",
      "Value": "",
      "Description": "E, ent√£o, se assegura que o radio button correto foi assinalado."
    },
    {
      "Command": "type",
      "Target": "id=txaObservacao",
      "Value": "${assuntos[${i}][7]}",
      "Targets": [
        "id=txaObservacao",
        "name=txaObservacao",
        "xpath=//*[@id=\"txaObservacao\"]",
        "xpath=//textarea[@id='txaObservacao']",
        "xpath=//textarea",
        "css=#txaObservacao"
      ],
      "Description": "Insere o texto, caso haja, na observa√ß√£o do assunto cadastrado."
    },
    {
      "Command": "echo",
      "Target": "üóÉÔ∏è Assunto ${assuntos[${i}][1]} - ${assuntos[${i}][2]} cadastrado com os prazos de guarda ${assuntos[${i}][4]} anos para corrente e ${assuntos[${i}][4]} anos para intermedi√°ria, e posterior encaminhamento para Guarda Permanente.",
      "Value": "purple",
      "Description": "Informa, no log do UI.Vision, que o item foi cadastrado, com seus prazos e destina√ß√£o \"Guarda permanente\"."
    },
    {
      "Command": "else",
      "Target": "",
      "Value": "",
      "Description": "Caso contr√°rio,"
    },
    {
      "Command": "check",
      "Target": "id=optDestinacao",
      "Value": "E",
      "Targets": [
        "xpath=//*[@id=\"divOptDestinacao\"]/div/label",
        "xpath=//fieldset[2]/div[2]/div/label",
        "css=#divOptDestinacao > div > label"
      ],
      "Description": "Assinala o radio button correspondente ao encaminhamento para elimina√ß√£o."
    },
    {
      "Command": "assertChecked",
      "Target": "id=optDestinacao",
      "Value": "",
      "Description": "E, ent√£o, se assegura que o radio button correto foi assinalado."
    },
    {
      "Command": "type",
      "Target": "id=txaObservacao",
      "Value": "${assuntos[${i}][7]}",
      "Targets": [
        "id=txaObservacao",
        "name=txaObservacao",
        "xpath=//*[@id=\"txaObservacao\"]",
        "xpath=//textarea[@id='txaObservacao']",
        "xpath=//textarea",
        "css=#txaObservacao"
      ],
      "Description": "Insere o texto, caso haja, na observa√ß√£o do assunto cadastrado."
    },
    {
      "Command": "echo",
      "Target": "üóÉÔ∏è Assunto ${assuntos[${i}][1]} - ${assuntos[${i}][2]} cadastrado com os prazos de guarda ${assuntos[${i}][4]} anos para corrente e ${assuntos[${i}][4]} anos para intermedi√°ria, e posterior encaminhamento para Elimina√ß√£o.",
      "Value": "purple",
      "Description": "Informa, no log do UI.Vision, que o item foi cadastrado, com seus prazos e destina√ß√£o \"elimina√ß√£o\"."
    },
    {
      "Command": "end",
      "Target": "",
      "Value": "",
      "Description": "(N√£o √© o fim da macro. Este comando √© padr√£o para opera√ß√µes \"if-else\", como a utilizada aqui. Ele indica que se encerra uma bifurca√ß√£o. Este √© o \"end\" do \"if\" da linha 34 da macro.)"
    },
    {
      "Command": "end",
      "Target": "",
      "Value": "",
      "Description": "(N√£o √© o fim da macro. Este comando √© padr√£o para opera√ß√µes \"if-else\", como a utilizada aqui. Ele indica que se encerra uma bifurca√ß√£o. Este √© o \"end\" do \"if\" da linha 24 da macro.)"
    },
    {
      "Command": "click",
      "Target": "name=sbmCadastrarAssunto",
      "Value": "",
      "Targets": [
        "name=sbmCadastrarAssunto",
        "xpath=//*[@id=\"divInfraBarraComandosSuperior\"]/button",
        "xpath=//button[@name='sbmCadastrarAssunto']",
        "xpath=//div/button",
        "css=#divInfraBarraComandosSuperior > button:nth-child(2)"
      ],
      "Description": "Executa o clique no bot√£o \"Salvar\"."
    },
    {
      "Command": "store",
      "Target": "true",
      "Value": "!statusOK",
      "Description": "Este comando √© necess√°rio para a valida√ß√£o do if posterior (linha 20)."
    },
    {
      "Command": "verifyElementPresent",
      "Target": "id=btnImprimir",
      "Value": "",
      "Targets": [
        "id=btnImprimir",
        "xpath=//*[@id=\"btnImprimir\"]",
        "xpath=//button[@id='btnImprimir']",
        "xpath=//button[2]",
        "css=#btnImprimir"
      ],
      "Description": "Esta etapa √© a confer√™ncia de que o SIP voltou √† tela anterior ap√≥s salvar."
    },
    {
      "Command": "if_v2",
      "Target": "${!statusOK} == true",
      "Value": "",
      "Description": "Este comando valida se a verifica√ß√£o anterior manteve o status da execu√ß√£o como bem sucedida. Se sim, mensagem de sucesso. Se n√£o, mensagem de erro."
    },
    {
      "Command": "executeScript_Sandbox",
      "Target": "return Number(${ok}) + 1;",
      "Value": "ok",
      "Description": "Primeiro, a macro acrescenta + 1 ao valor de \"ok\", ou seja, acrescenta uma execu√ß√£o bem-sucedida √† conta."
    },
    {
      "Command": "echo",
      "Target": "‚úÖ Assunto ${assuntos[${i}][1]} - ${assuntos[${i}][2]} cadastrado com sucesso.",
      "Value": "green",
      "Description": "E por meio desta linha, exibe a mensagem de sucesso no log."
    },
    {
      "Command": "else",
      "Target": "",
      "Value": "",
      "Description": "caso contr√°rio..."
    },
    {
      "Command": "storeText",
      "Target": "id=divInfraMensagens",
      "Value": "mensagemErro",
      "Description": "a macro armazena a mensagem de erro exibida pelo SIP,"
    },
    {
      "Command": "executeScript_Sandbox",
      "Target": "return Number(${falha}) + 1;",
      "Value": "falha",
      "Description": "em seguida, acrescenta + 1 ao valor de \"falha\", ou seja, acrescenta uma execu√ß√£o malsucedida √† conta..."
    },
    {
      "Command": "echo",
      "Target": "‚ùå Falha ao cadastrar o assunto ${assunto[${i}][1]} - ${assuntos[${i}][2]}. Erro: \"${mensagemErro}\"",
      "Value": "red",
      "Description": "E, ent√£o, por meio desta linha, exibe a mensagem de falha no log."
    },
    {
      "Command": "clickAndWait",
      "Target": "id=btnCancelar",
      "Value": "",
      "Description": "Este clique no bot√£o \"Cancelar\" permite √† macro retornar √† tela anterior para retomar o cadastro."
    },
    {
      "Command": "end",
      "Target": "",
      "Value": "",
      "Description": "(N√£o √© o fim da macro. Este comando √© padr√£o para opera√ß√µes \"if-else\", como a utilizada aqui. Ele indica que se encerra uma bifurca√ß√£o. Este √© o \"end\" do \"if\" da linha 15 da macro.)"
    },
    {
      "Command": "executeScript_Sandbox",
      "Target": "return Number(${i}) + 1;",
      "Value": "i",
      "Description": "Esta linha acrescenta + 1 ao valor de \"i\", que corresponde √† linha a ser lida pela macro at√© chegar ao valor m√°ximo. Ou seja, este √© o comando que faz as itera√ß√µes se repetirem enquanto houver dados a cadastrar."
    },
    {
      "Command": "end",
      "Target": "",
      "Value": "",
      "Description": "(N√£o √© o fim da macro. Este comando √© padr√£o para opera√ß√µes \"if-else\", como a utilizada aqui. Ele indica que se encerra uma bifurca√ß√£o. Este √© o \"end\" do \"while\" da linha 10 da macro.)"
    },
    {
      "Command": "executeScript_Sandbox",
      "Target": "return Number(${ok}) + Number(${falha});",
      "Value": "total",
      "Description": "Esta fun√ß√£o compila os resultados das execu√ß√µes bem-sucedidas e das falhas."
    },
    {
      "Command": "echo",
      "Target": "üèÅ Carga finalizada: ${total} registros processados, sendo ${ok} com sucesso e ${falha} com erro.",
      "Value": "",
      "Description": "E, por fim, esta linha relata - ao final da execu√ß√£o da macro - quantos registros foram processados, quantos com sucesso e quantos com erro."
    }
  ]
}
